<!DOCTYPE html>
<html lang="en">
<head>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M7CNXDK');</script>
    <!-- End Google Tag Manager -->
    

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-983EZBYB1K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-983EZBYB1K');
</script>


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="description" content="Utah Geochronology">
 
  <title>Utah Geochronology</title>

  <!-- Calcite Maps Bootstrap -->
  <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-bootstrap.min-v0.10.css">

  <!-- Calcite Maps -->
  <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-arcgis-4.x.min-v0.10.css">
  <!--link rel="stylesheet" href="../../dist/css/calcite-maps.min-v0.10.css"--> <!-- works -->

  <!-- ArcGIS JS 4 -->
  <!-- <link rel="stylesheet" href="https://js.arcgis.com/4.10/esri/css/main.css"> -->

  <style>
    html,
    body {
        margin: 0;
        padding: 0;
        height: 100%;
    }

    a {
    cursor: pointer;
    }

    .esri-layer-list__item-actions-menu-item--active, .esri-layer-list__item-actions-menu-item--active:hover {
    background-color: whitesmoke;
    }

    .calcite-title:before {
        content: url('/apps/_ugsmaptemplate/logo_main.png');
        padding: 6px 12px 0 2px;
        cursor: pointer;
    }

    /* adjust the font size of text in the search feature table grid  */
    .esri-grid .esri-grid__content {
        font-size: 11px !important;
    }
    /* make text wrap in the grid  */
    vaadin-grid-cell-content {
        white-space: normal !important;
    }

    .calcite-maps .calcite-search-expander .esri-search__sources-button.esri-widget--button {
        display: block !important;
    }

    .calcite-maps .calcite-search-expanded .esri-menu.esri-search__sources-menu {
        display: block !important;
    }
  </style>
  
</head>

<body class="calcite-maps calcite-nav-top">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M7CNXDK"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

  <!-- Navbar -->
  <a class="ugs-watermark " href="https://geology.utah.gov"></a>
  <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-light calcite-bg-dark calcite-bgcolor-dark">
      <!-- Menu -->
      <div class="dropdown calcite-dropdown calcite-bg-light calcite-text-dark" role="presentation">
          <a class="dropdown-toggle" role="menubutton" aria-haspopup="true" aria-expanded="false" tabindex="0">
              <div class="calcite-dropdown-toggle">
                  <span class="sr-only">Toggle dropdown menu</span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
              </div>
          </a>
          <ul class="dropdown-menu calcite-menu">
              <li><a class="active hidden-md hidden-lg" href="#mapTab" aria-controls="mapTab" role="tab" data-toggle="tab"> 2D</a></li>
              <li><a class="hidden-md hidden-lg" href="#sceneTab" aria-controls="sceneTab" role="tab" data-toggle="tab"> 3D</a></li>
              <li><a role="menuitem" tabindex="0" data-target="#panelInfo" aria-haspopup="true"><span class="glyphicon glyphicon-info-sign"></span> About</a></li>
              <li><a role="menuitem" tabindex="0" data-target="#panelLegend" aria-haspopup="true"><span class="glyphicon glyphicon-list-alt"></span> Legend</a></li>
              <li><a role="menuitem" tabindex="0" data-target="#panelBasemaps" aria-haspopup="true"><span class="esri-icon-basemap"></span> Basemaps</a></li>
              <!-- <li><a role="menuitem" tabindex="0" data-target="#calciteLocate" id="calciteLocate" aria-haspopup="true"><span class="glyphicon glyphicon-map-marker"></span> Locate</a></li> -->
              <!-- <li><a role="menuitem" tabindex="0" id="calciteToggleNavbar" aria-haspopup="true"><span class="glyphicon glyphicon-fullscreen"></span> Full Map</a></li> -->
          </ul>
      </div>
      <!-- Title -->
      <div class="calcite-title calcite-overflow-hidden">
          <span class="calcite-title-main">Utah Geological Survey</span>
          <span class="calcite-title-divider hidden-xs"></span>
          <span class="calcite-title-sub hidden-xs">Utah Geochronology Database</span>
      </div>
      <!-- Nav -->
      <ul class="calcite-nav nav navbar-nav">
          <!-- <li><a id="mapNav" class="hidden-xs hidden-sm" href="#mapTab" aria-controls="mapTab" aria-expanded="true" role="tab" data-toggle="tab" data-tooltip="tip" title="2D View" data-placement="bottom">2D View</a></li>
    <li class="active"><a id="sceneNav" class="hidden-xs hidden-sm" href="#sceneTab" aria-controls="mapTab" role="tab" data-toggle="tab" data-tooltip="tip" title="3D View" data-placement="bottom">3D View</a></li>                   -->
          <li>
              <div class="calcite-navbar-search calcite-search-expander" role="presentation" tabindex="-1">
                  <div id="searchNavDiv" tabindex="0"></div>
              </div>
          </li>
      </ul>
  </nav>
  <!--/.navbar -->

  <!-- Map Container  -->

  <div class="calcite-map calcite-map-absolute">
      <div id="tabContainer" class="tab-content">
          <div id="mapTab" class="tab-pane fade in active" role="tabpanel">
              <div id="mapViewDiv"></div>
          </div>
          <!-- <div id="sceneTab" class="tab-pane fade in active" role="tabpanel">
      <div id="sceneViewDiv"></div>
    </div> -->
      </div>
  </div>

  <!-- Panel Container -->

  <div class="calcite-panels calcite-panels-right calcite-bg-custom calcite-text-light calcite-bgcolor-dark panel-group" role="tablist" aria-multiselectable="true">

      <!-- Info Panel -->

      <div id="panelInfo" class="panel collapse in">
        <div id="headingInfo" class="panel-heading" role="tab">
          <div class="panel-title">
            <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseInfo"  aria-expanded="true" aria-controls="collapseInfo"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span><span class="panel-label">About</span></a> 
            <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelInfo"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>  
          </div>
        </div>
        <div id="collapseInfo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingInfo">
          <div class="panel-body">
                  <p><strong>UTAH GEOCHRONOLOGY</strong></p>
                  <p align="justify">The Utah Geochronology Database contains ages and related dating information of sampled geologic materials (soil and rock) using argon (40Ar/39Ar), tephrochronology, fission track, cosmogenic, luminescence (TL, IRSL, and OSL), tritium, radiocarbon (14C), rubidium-strontium (87Rb/87Sr), or uranium-thorium-lead (238U-235U/206Pb-207Pb) dating methods and were analyzed for a variety of geologic-related projects by the Utah Geological Survey (UGS), U.S. Geological Survey (USGS; incorporates Utah data from the National Geochronological Database) and others.
                      <br><br>Since geochronologic methods have significantly evolved and improved through time, older data is often not as reliable or usable as more recently dated materials. The user should use caution in using this data, as significant knowledge and experience is often needed to interpret and apply geochronologic data to projects correctly.
                      <br><br>As the database is expanded in the future, age results from other geochronologic dating methods are anticipated to be added. Various geochronologic data from geologic mapping projects may be found <a href="https://wp.me/P5HpmR-1mq" target="_blank"><font color="blue">here</font></a>. Donations of geochronologic data in Utah are appreciated, so that these data can be permanently archived and discoverable and available to all users. <a href="https://geology.utah.gov/about-us/#directory" target="_blank"><font color="blue">Contact the UGS</font></a> for more details.
                      <br><br>GIS data for the Utah Geochronology Database is available <a href="https://opendata.gis.utah.gov/maps/utahDNR::utah-geochronology/about" target="_blank"><font color="blue"> here</font></a>.
                  </p>
                  <br>
                  <br>
              </div>
          </div>
      </div>

      <!-- Basemaps Panel -->

      <div id="panelBasemaps" class="panel collapse">
          <div id="headingBasemaps" class="panel-heading" role="tab">
              <div class="panel-title">
                  <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseBasemaps" aria-expanded="false" aria-controls="collapseBasemaps"><span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Basemaps</span></a>
                  <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelBasemaps"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
              </div>
          </div>
          <div id="collapseBasemaps" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingBasemaps">
              <div class="panel-body">
                  <select id="selectBasemapPanel" class="form-control">
                      <option value="streets" data-vector="streets-vector">Streets</option>
                      <option value="satellite" data-vector="satellite">Satellite</option>
                      <option value="hybrid" data-vector="hybrid">Hybrid</option>
                      <option value="national-geographic" data-vector="national-geographic">National Geographic</option>
                      <option value="topo-vector" data-vector="topo-vector" selected="">Topographic</option>
                      <option value="gray" data-vector="gray-vector">Gray</option>
                      <option value="dark-gray" data-vector="dark-gray-vector">Dark Gray</option>
                      <option value="osm" data-vector="osm">Open Street Map</option>
                      <option value="dark-gray" data-vector="streets-night-vector">Streets Night</option>
                      <option value="streets" data-vector="streets-navigation-vector">Streets Mobile</option>
                  </select>
              </div>
          </div>
      </div>

      <!-- Panel - Legend -->

      <div id="panelLegend" class="panel collapse">
          <div id="headingLegend" class="panel-heading" role="tab">
              <div class="panel-title">
                  <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseLegend" aria-expanded="false" aria-controls="collapseLegend"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Legend</span></a>
                  <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelLegend"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
              </div>
          </div>
          <div id="collapseLegend" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingLegend">
              <div class="panel-body">
                  <div id="legendDiv"></div>
              </div>
          </div>
      </div>

      <!-- Grid panelSearch panel -->
      <div id="panelGrid" class="panel collapse">
          <div id="headingInfo" class="panel-heading" role="tab">
              <div class="panel-title">
                  <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseGrid" aria-expanded="false" aria-controls="collapseGrid"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Search Results</span></a>
                  <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelGrid"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
              </div>
          </div>
          <div id="collapseGrid" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingGrid">
              <div class="panel-body">
                  <div id="grid"></div>
              </div>
          </div>
      </div>


      <!-- Attribute Details panel -->
      <div id="panelDetails" class="panel collapse">
          <div id="headingInfo" class="panel-heading" role="tab">
              <div class="panel-title">
                  <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseDetails" aria-expanded="true" aria-controls="collapseDetails"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label" id="details">All Available Sample Data</span></a>
                  <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelDetails"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
              </div>
          </div>
          <div id="collapseDetails" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingDetails">
              <div class="panel-body">

                  <div id="attDetails"></div>
                  <div id="labDetails"></div>

              </div>
          </div>
      </div>

      <!-- Lab Details panel -->
      <div id="panelLab" class="panel collapse">
          <div id="headingInfo" class="panel-heading" role="tab">
              <div class="panel-title">
                  <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseLab" aria-expanded="true" aria-controls="collapseLab"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Laboratory Details</span></a>
                  <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelLab"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
              </div>
          </div>
          <div id="collapseLab" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingLab">
              <div class="panel-body">

                  <div id="attLab"></div>

              </div>
          </div>
      </div>

  </div> <!-- /.calcite-panels -->



  <script src="https://momentjs.com/downloads/moment.js"></script>

  <script type="text/javascript">
    var dojoConfig = {
      packages: [{
        name: "bootstrap",
        location: "https://esri.github.io/calcite-maps/dist/vendor/dojo-bootstrap"
      },
      {
        name: "calcite-maps",
        location: "https://esri.github.io/calcite-maps/dist/js/dojo"
      }]
    };
  </script>


<link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css" />
  <!-- ArcGIS JS 4 -->
  <script src="https://js.arcgis.com/4.24/"></script>

  <script>
    var app;
    const aliases={"objectid":"OBJECTID","shape":"Shape","project":"Project","sampleid":"Sample Identification","sampletype":"Sample Type","samplematerial":"Sample Material","sampleunit":"Sample Unit","sampledate":"Sample Date","sampleby":"Sample By","samplephotors":"Sample Photo RS","sampletestflag":"Sample Test Flag","samplereliability":"Sample Reliability","samplelocation":"Sample Location","locationtype":"Sample Coordinate Source","samplelatitude":"Sample Latitude","samplelongitude":"Sample Longitude","sampleelevation":"Sample Elevation","localx":"Local Coordinates X","localy":"Local Coordinates Y","localz":"Local Coordinates Z","locationxyaccuracy":"Location XY Accuracy","locationzaccuracy":"Location Z Accuracy","lab":"Laboratory","labsampleid":"Sample Identification","labtestdate":"Laboratory Report Date","datingtype":"Dating Type","dating_method":"Dating Method","datinganalysis":"Dating Analysis","equivalentdose":"Equivalent Dose","equivalentdoserange":"Equivalent Dose Range","age":"Age","agerange":"Age Range","agesigma":"Age Sigma","labreport":"Lab Report","labreportrs":"UGS GeoData Archive Resource ID","recorddate":"Initial Database Entry Date/Time","updatedate":"Last Database Update Date/Time","labnotes":"Lab Notes","samplenotes":"Sample Notes","updated_by":"Updated By","project_id":"Project_ID","projectname":"ProjectName","projecttype":"Project Type","projectlocation":"ProjectLocation","orgname":"OrgName","orgaddress1":"OrgAddress1","orgaddress2":"OrgAddress2","orgcity":"OrgCity","orgstate":"OrgState","orgzipcode":"OrgZipCode","orgphone":"OrgPhone","orgurl":"OrgURL","orgcontact":"OrgContact","orgcontactphone":"OrgContactPhone","orgcontactemail":"OrgContactEmail","publication_url":"Publication_URL","shape_length":"Shape_Length","shape_area":"Shape_Area","206pb_238u_age":"206Pb/238U Age","206pb_238u_age_uncertainty":"206Pb/238U Age Uncertainty","207pb_235u_age":"207Pb/235U Age","207pb_235u_age_uncertainty":"207Pb/235U Age Uncertainty","207pb_206pb_age":"207Pb/206Pb Age","207pb_206pb_age_uncertainty":"207Pb/206Pb Age Uncertainty","208pb_232th_age":"208Pb/232Th Age","208pb_232th_age_uncertainty":"208Pb/232Th Age Uncertainty","upperintercept":"Upper Intercept","upperinterceptuncertainty":"Upper Intercept Uncertainty","lowerintercept":"Lower Intercept","lowerinterceptuncertainty":"Lower Intercept Uncertainty","initialpbcomposition":"Initial Pb Composition","decayconstaints":"Decay Constaints","u_concentration":"U Concentration","th_concentration":"Th Concentration","pb_concentration":"Pb Concentration","isotopicconcentration204pb":"204Pb Concentration","isotopic_concentration_206pb":"206Pb Concentration","isotopic_concentration_207pb":"207Pb Concentration","isotopic_concentration_208pb":"208Pb Concentration","ageuncertainty":"Age Uncertainty","initial87sr_86sr":"Initial 87Sr/86Sr","decayconstants":"Decay Constants","rbconcentration":"Rb Concentration","srconcentration":"Sr Concentration","radiogenic87sr":"Radiogenic 87Sr","ratio_87rb_86sr":"Ratio 87Rb/86Sr","ratio_87sr_86sr":"Ratio 87Sr/86Sr","trackdensity":"Track Density (count per square cm)","trackscounted":"Tracks Counted","inducedtrackdensity":"Induced Track Density","inducedtrackscounted":"Induced Tracks Counted","totalinducedtrackrates":"Total Induced Track Rates","neutronfluxdensity":"Neutron Flux Density","uraniumconcentration":"Uranium Concentration","chlorine36":"Chlorine36","chlorine36_error":"Chlorine36 Error","samplethickness":"Sample Thickness","externalerror":"External Error","shieldingfactor":"Shielding Factor","erosionrate":"Erosion Rate","calibrationdataset":"Calibration Dataset","atomcountsigma":"Atom Count Sigma","ageerror":"Age Error","ageerrorsigma":"Age Error Sigma","numbershards":"Number of Shards","d2h":"d2H","d18o":"d18O","c13c12ratio":"C13C12 Ratio","c14pmc":"C14PMC","c14pmcerror1sigma":"C14PMC Error 1 Sigma","tritium":"Tritium","tritiumerror1sigma":"Tritium Error 1 Sigma","qualitativeage":"Qualitative Age","hravg":"Hravg","travg":"Travg","f14c_age_mi":"F14C_age_mi","f14c_age_ma":"F14C_age_ma","f14c_age":"F14C_age","f14c_age_av":"F14C_age_av","ageaverageerror":"Age Average Error","ageaveragemodern":"Age Average Modern","phage":"PH Age","cfage":"CF Age","fgage":"FG Age","conventionalage":"Conventional Age","c13c12ratioerror1sigma":"C13C12 Ratio Error 1 Sigma","conventionalageerror":"Conventional Age Error","qualitativeageerror":"Qualitative Age Error","fgageerror":"FG Age Error","cfageerror":"CF Age Error","phageerror":"PH Age Error","calibratedage1a":"Calibrated Age 1A","calibratedage1b":"Calibrated Age 1B","calibratedage1sigma":"Calibrated Age 1 Sigma","calibratedage1unit":"Calibrated Age 1 Unit","calibratedage2a":"Calibrated Age 2A","calibratedage2b":"Calibrated Age 2B","calibratedage2sigma":"Calibrated Age 2 Sigma","calibratedage2unit":"Calibrated Age 2 Unit","calibratedage3a":"Calibrated Age 3A","calibratedage3b":"Calibrated Age 3B","calibratedage3sigma":"Calibrated Age 3 Sigma","calibratedage3unit":"Calibrated Age 3 Unit","calibrationcurve":"Calibration Curve","labcode":"LabCode","labactive":"LabActive","labname":"LabName","labaddress1":"LabAddress1","labaddress2":"LabAddress2","labcity":"LabCity","labstate":"LabState","labzipcode":"LabZipCode","labphone":"LabPhone","laburl":"LabURL","labcontact":"LabContact","labcontactphone":"LabContactPhone","labcontactemail":"LabContactEmail"};

require([
    "esri/Map",
    "esri/Basemap",
    "esri/Graphic",
    "esri/symbols/SimpleMarkerSymbol",
    "esri/layers/WFSLayer",
	"esri/layers/ogc/wfsUtils",
    "esri/layers/FeatureLayer",
    "esri/views/MapView",
    "esri/widgets/Search",
    "esri/widgets/Home",
    "esri/widgets/Zoom",
    "esri/widgets/Compass",
    "esri/widgets/Locate",
    "esri/widgets/Legend",
    "esri/widgets/BasemapToggle",
    "esri/widgets/LayerList",
    "esri/widgets/FeatureTable",
    "esri/core/reactiveUtils",
    // Calcite-maps
    "calcite-maps/calcitemaps-v0.10",
    "calcite-maps/calcitemaps-arcgis-support-v0.10",
    // Bootstrap
    "bootstrap/Collapse",
    "bootstrap/Dropdown",
    "bootstrap/Tab",

], function(Map, Basemap, Graphic, SimpleMarkerSymbol, WFSLayer, WFSUtils, FeatureLayer, MapView, Search, Home, Zoom, Compass, Locate, Legend, BasemapToggle, LayerList, FeatureTable, reactiveUtils, CalciteMaps, CalciteMapsArcGIS
) {
    // App
    app = {
        zoom: 8,
        center: [-112, 39.5],
        basemap: "topo-vector",
        viewPadding: {
            top: 50,
            bottom: 0
        },
        uiPadding: {
            top: 15,
            bottom: 15
        },
        map: null,
        mapView: null,
        activeView: null,
        searchWidgetNav: null,
        containerMap: "mapViewDiv",
        containerScene: "sceneViewDiv"
    };
    // Map 
    app.map = new Map({
        basemap: app.basemap,
        //ground: "world-elevation"
    });
    // 2D View
    app.mapView = new MapView({
        container: app.containerMap, // deactivate
        map: app.map,
        zoom: 8,
        center: [-112, 39.5],
        padding: app.viewPadding,
        ui: {
            components: ["zoom", "compass", "home"],
            padding: app.uiPadding
        }
    });
    // Active view is scene
    setActiveView(app.mapView);
    // Create search widget
    app.searchWidgetNav = new Search({
        container: "searchNavDiv",
        view: app.activeView,
        includeDefaultSources: false,
        maxResults: 100,
        maxSuggestions: 16,
        minSuggestCharacters: 2,
        popupOpenOnSelect: true
    });
    // Wire-up expand events
    CalciteMapsArcGIS.setSearchExpandEvents(app.searchWidgetNav);
    CalciteMapsArcGIS.setPopupPanelSync(app.mapView);
    //CalciteMapsArcGIS.setPopupPanelSync(app.sceneView);
    // Menu UI - change Basemaps
    $("#selectBasemapPanel").on("change", function(e) {
        app.mapView.map.basemap = e.target.options[e.target.selectedIndex].dataset.vector;
        //app.sceneView.map.basemap = e.target.value;
    });
    // Tab UI - switch views
    $(".calcite-navbar li a[data-toggle='tab']").on("click", function(e) {
        if (e.target.text.indexOf("2D") > -1) {
            //syncViews(app.sceneView, app.mapView);
            setActiveView(app.mapView);
        } else {
            syncViews(app.mapView, app.sceneView);
            //setActiveView(app.sceneView);
        }
        syncSearch(app.activeView);
    });
    // Views
    function syncViews(fromView, toView) {
        var viewPt = fromView.viewpoint.clone();
        fromView.container = null;
        if (fromView.type === "3d") {
            toView.container = app.containerMap;
        } else {
            toView.container = app.containerScene;
        }
        toView.viewpoint = viewPt;
        toView.padding = app.viewPadding;
    }

    // Active view
    function setActiveView(view) {
        app.activeView = view;
    }

    var home = new Home({
        view: app.activeView
    });
    app.activeView.ui.add(home, "top-left");

    var locate = new Locate({
        view: app.activeView
    });
    app.activeView.ui.add(locate, "top-left");

    // Panel widgets - add legend
    var legendWidget = new Legend({
        //container: "legendDiv",
        view: app.activeView
    });
    //Panel widgets - layerlist
    var layerList = new LayerList({
        view: app.activeView,
        container: "legendDiv",
        listItemCreatedFunction: function(event) {
            const item = event.item;
            if (item.layer.type != "group") { // don't show legend twice
                item.panel = {
                    content: "legend",
                    open: true
                };
            } 
        }
    });


    // show or hide any open calicite panels when user clicks for attribute details
    function showHideCalcitePanels(showPanel, showCollapse) {
        // hide all windows
        $(".panel.in").removeClass("in"); //close any open panels
        $(".panel-collapse").removeClass("in");

        // if specified show this calcite panel
        if (showPanel) {
            $(showPanel).addClass("in");
            $(showCollapse).addClass("in");
            //showPanel.collapse("show"); 
            //showCollapse.collapse("show");
        }
    }

    // assign click even to fault name so summary goes to Fault Summary panel
    //function addClickHandler(att, lyr) {
        /*
        //var el = $("#dataDetail");
        $(document).off("click", "#dataDetail");
        //$("#dataDetail").on("click", function(e) {
        $(document).on("click", "#dataDetail", function(e) {
            showHideCalcitePanels("#panelDetails", "#collapseDetails");
            populateDetailsPanel(lyr, att);
        });
        return false;
        */
    //}

    // fetch info
    var popupAction = {
        title: "Click to Preview Data",
        id: "sample-data",
        className: "esri-icon-table"
    };

    app.activeView.popup.on("trigger-action", function(event,data) {
        if (event.action.id === "sample-data") {
            console.log("trigger event firing!!")
            var graphic = app.activeView.popup.viewModel.selectedFeature;
            //if (graphic.sourceLayer.id == 'sites-layer' || graphic.sourceLayer.id == 'world-sites'){
            console.log(graphic);
            console.log(graphic.layer.name);
            console.log(graphic.attributes.__esri_wfs_id__);
            //populateDetailsPanel(graphic.layer.name, graphic.attributes.__esri_wfs_id__);
            showHideCalcitePanels("#panelDetails", "#collapseDetails");
            populateDetailsPanel(graphic.attributes,graphic.layer.name);
        }
    });

    reactiveUtils.on(
        () => app.activeView.popup.viewModel,
        "trigger-action",
        (event) => {
            if (event.action.id === "sample-data") {
            // do the above stuff
        }
    });

    reactiveUtils.watch(
        () => app.activeView.popup.selectedFeature,
        (graphic) => {
            if (graphic) {
                if (graphic.attributes.__esri_wfs_id__){   //if its the topo poly layer dont populate
                    //console.log("fired the reactive util!");
                    showHideCalcitePanels("#panelDetails", "#collapseDetails");
                    populateDetailsPanel(graphic.attributes,graphic.layer.name);
                }
            }
        }
    );


//Popup Templates for All Methods ------------------------------------------------------------

    var contentTeph = function(value) {
        var content = "";
        //console.log(value.graphic);
        var data = value.graphic.attributes;

        if (data.project) {
            content += "<span class='bold' title=''><b> " + data.project + " </b></span><br>";
        }

        if (data.sampleid) {
            if (data.sampleid) {
                content += "<span class='bold' title=''><b>&ensp;Sample</b></span><br> <span id='chronID' class='bold' data-lyr='8' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp;<b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                content += "<span class='bold' title='Sample Material'>&ensp;&ensp;<b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }
        if (data.age) {
            if (data.age) {
                content += "<span class='bold' title='Age'>&ensp;&ensp;<b>Age: </b></span>" + data.age.toFixed(2) + " ± " + data.ageerror + " yr (1σ error)<br>";
            }
        }

        if (data.labreportsrs) {
            //content += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
            if (data.labreportsrs) {
                content += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportsrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportsrs == null) {
                content += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return content;
    };

        


    getContentTrit = function(value) {
    var content = "";
    //console.log(value.graphic);
    var data = value.graphic.attributes;

    if (data.project) {
        content += "<span class='bold' title=''><b> " + data.project + " </b></span><br>";
    }

    if (data.sampleid) {
        if (data.sampleid) {
            content += "<span class='bold' title=''><b>&ensp;Sample</b></span><br> <span id='chronID' class='bold' data-lyr='9' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp;<b>Identification: </b></span>" + data.sampleid + "<br>";
        }
    }
    if (data.samplematerial) {
        if (data.samplematerial) {
            content += "<span class='bold' title='Sample Material'>&ensp;&ensp;<b>Material: </b></span>" + data.samplematerial + "<br>";
        }
    }
    if (data.conventionalage) {
        if (data.conventionalage) {
            content += "<span class='bold' title='Conventional Age'>&ensp;&ensp;<b>Conventional Age: </b></span>" + data.conventionalage.toFixed(2) + " yr (1σ error)<br>";
        }
    }

    if (data.qualitativeage) {
        if (data.qualitativeage) {
            content += "<span class='bold' title='Qualitative Age'>&ensp;&ensp;<b>Qualitative Age: </b></span>" + data.qualitativeage + " yr (1σ error)<br>";
        }
    }

    if (data.ageaveragemodern) {
        if (data.ageaveragemodern) {
            content += "<span class='bold' title='Average Modern Age'>&ensp;&ensp;<b>Average Modern Age: </b></span>" + data.ageaveragemodern.toFixed(2) + " ± " + data.ageaverageerror + " yr (1σ error)<br>";
        }
    }

    if (data.labreportsrs) {
        //content += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
        if (data.labreportsrs) {
            content += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportsrs + "' target='_blank'>Opens in new tab</a>";
        } else if (data.labreportsrs == null) {
            content += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
        }
    }

    return content;
};


    createClickContentCarbon = function(value) {
        var content = "";
        //console.log(value.graphic);
        var data = value.graphic.attributes;

        if (data.project) {
            content += "<span class='bold' title=''><b> " + data.project + " </b></span><br>";
        }

        if (data.sampleid) {
            if (data.sampleid) {
                content += "<span class='bold' title=''><b>&ensp;Sample</b></span><br> <span id='chronID' class='bold' data-lyr='2' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp;<b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                content += "<span class='bold' title='Sample Material'>&ensp;&ensp;<b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }

        if (data.datingtype) {
            content += "<span class='bold' title=''>&ensp;<b>Results</b></span><br>";
            if (data.datingtype) {
                content += "<span class='bold' title='Dating Type'>&ensp;&ensp;<b>Type: </b></span>" + data.datingtype + "<br>";
            }
        }
        if (data.conventionalage) {
            if (data.conventionalage) {
                content += "<span class='bold' title='Conventional Age'>&ensp;&ensp;<b>Conventional Age: </b></span>" + data.conventionalage.toFixed(2) + " ± " + data.conventional1sigma + " yr (1σ error)<br>";
            }
        }

        if (data.calibratedage1a) {
            if (data.calibratedage1a != null && data.calibratedage1b != null && data.calibratedage1unit != null && data.calibratedage1sigma != null) {
                content += "<span class='bold' title='Calibrated Age'>&ensp;&ensp;<b>Calibrated Age: </b></span>" + data.calibratedage1a + " - " + data.calibratedage1b + " " + data.calibratedage1unit + " *See detailed report for explanation" + "<br>";
            } else if (data.calibratedage1a == null && data.calibratedage1b != null && data.calibratedage1unit != null && data.calibratedage1sigma != null) {
                content += "<span class='bold' title='Calibrated Age'>&ensp;&ensp;<b>Calibrated Age: </b></span>" + "" + " - " + data.calibratedage1b + " " + data.calibratedage1unit + " *See detailed report for explanation" + "<br>";
            } else if (data.calibratedage1a != null && data.calibratedage1b == null && data.calibratedage1unit != null && data.calibratedage1sigma != null) {
                content += "<span class='bold' title='Calibrated Age'>&ensp;&ensp;<b>Calibrated Age: </b></span>" + data.calibratedage1a + " - " + " " + data.calibratedage1unit + " *See detailed report for explanation" + "<br>";
            } else if (data.calibratedage1a != null && data.calibratedage1b != null && data.calibratedage1unit == null && data.calibratedage1sigma != null) {
                content += "<span class='bold' title='Calibrated Age'>&ensp;&ensp;<b>Calibrated Age: </b></span>" + data.calibratedage1a + " - " + data.calibratedage1b + " *See detailed report for explanation" + "<br>";
            } else if (data.calibratedage1a != null && data.calibratedage1b != null && data.calibratedage1unit != null && data.calibratedage1sigma == null) {
                content += "<span class='bold' title='Calibrated Age'>&ensp;&ensp;<b>Calibrated Age: </b></span>" + data.calibratedage1a + " - " + data.calibratedage1b + " " + data.calibratedage1unit + " *See detailed report for explanation" + "<br>";
            }
        }
        if (data.labreportsrs) {
            //content += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
            if (data.labreportsrs) {
                content += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportsrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportsrs == null) {
                content += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return content;
    };


    //Luminesence PopupTemplate function

    createClickContentLum = function(value) {
        var contentLum = "";
        //console.log(value.graphic);
        var data = value.graphic.attributes;

        if (data.project) {
            contentLum += "<span class='bold' title=''></span><b>" + data.project + "</b><br>";
        }
        if (data.sampleid) {
            contentLum += "<span class='bold' title=''>&ensp; <b>Sample</b></span><br>";

            if (data.sampleid) {
                contentLum += "<span id='chronID' class='bold' data-lyr='1' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp; <b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.datingtype) {
            contentLum += "<span class='bold' title=''>&ensp; <b>Results</b></span><br>";

            if (data.datingtype) {
                contentLum += "<span class='bold' title='Dating Type'>&ensp;&ensp;<b> Type: </b></span>" + data.datingtype + "<br>";
            }
        }
        if (data.age) {
            if (data.age) {
                contentLum += "<span class='bold' title='Conventional Age'>&ensp;&ensp; <b>Age: </b></span>" + data.age.toFixed(2) + " ± " + data.agerange.toFixed(2) + " yr (1σ error)<br>";
            }
        }

        if (data.labreportrs) {
            //contentLum += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
            if (data.labreportrs) {
                contentLum += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportrs == null) {
                contentLum += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return contentLum;
    };

    createClickContentAr = function(value, key, data) {
        var contentAr = "";
        //console.log(value.graphic);
        var data = value.graphic.attributes;

        if (data.project) {
            contentAr += "<span class='bold' title=''></span><b>" + data.project + "</b><br>";
        }
        if (data.sampleid) {
            contentAr += "<span class='bold' title=''>&ensp; <b>Sample</b></span><br>";

            if (data.sampleid) {
                contentAr += "<span id='chronID' class='bold' data-lyr='3' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp; <b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                contentAr += "<span class='bold' title='Sample Material'>&ensp;&ensp; <b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }
        if (data.age) {
            if (data.age) {
                contentAr += "<span class='bold' title='Conventional Age'>&ensp;&ensp; <b>Age: </b></span>" + data.age.toFixed(2) + " ± " + data.agerange.toFixed(2) + " yr (1σ error)<br>";
            }
        }

        if (data.labreportrs) {
            //contentAr += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
            if (data.labreportrs) {
                contentAr += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportrs == null) {
                contentAr += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return contentAr;
    };


    createClickContentThor = function(value) {
        var contentThor = "";
        //console.log(value.graphic);
        var data = value.graphic.attributes;

        if (data.project) {
            contentThor += "<span class='bold' title=''></span><b>" + data.project + "</b><br>";
        }
        if (data.sampleid) {
            contentThor += "<span class='bold' title=''>&ensp; <b>Sample</b></span><br>";

            if (data.sampleid) {
                contentThor += "<span id='chronID' class='bold' data-lyr='4' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp; <b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                contentThor += "<span class='bold' title='Sample Material'>&ensp;&ensp; <b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }

        if (data.labreportrs) {
            //contentThor += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
            if (data.labreportrs) {
                contentThor += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportrs == null) {
                contentThor += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return contentThor;
    };

    createClickContentRhu = function(value) {
        var contentRhu = "";
        //console.log(value.graphic);
        var data = value.graphic.attributes;

        if (data.project) {
            contentRhu += "<span class='bold' title=''></span><b>" + data.project + "</b><br>";
        }
        if (data.sampleid) {
            contentRhu += "<span class='bold' title=''>&ensp; <b>Sample</b></span><br>";

            if (data.sampleid) {
                contentRhu += "<span id='chronID' class='bold' data-lyr='5' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp; <b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                contentRhu += "<span class='bold' title='Sample Material'>&ensp;&ensp; <b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }
        if (data.age) {
            if (data.age) {
                contentRhu += "<span class='bold' title='Conventional Age'>&ensp;&ensp; <b>Age: </b></span>" + data.age + " yr <br>";
            }
        }

        if (data.labreportrs) {
            //contentRhu += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click </a><br>";
            if (data.labreportrs) {
                contentRhu += "<span class='bold' title='Show complete report for " + data.sampleid + "'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportrs == null) {
                contentRhu += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return contentRhu;
    };

    createClickContentFis = function(value) {
        var contentFis = "";
        var data = value.graphic.attributes;

        if (data.project) {
            contentFis += "<span class='bold' title=''></span><b>" + data.project + "</b><br>";
        }
        if (data.sampleid) {
            contentFis += "<span class='bold' title=''>&ensp; <b>Sample</b></span><br>";
            if (data.sampleid) {
                contentFis += "<span id='chronID' class='bold' data-lyr='6' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp; <b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                contentFis += "<span class='bold' title='Sample Material'>&ensp;&ensp; <b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }
        if (data.age) {
            if (data.age) {
                contentFis += "<span class='bold' title='Conventional Age'>&ensp;&ensp; <b>Age: </b></span>" + data.age.toFixed(2) + " yr <br>";
            }
        }
        if (data.labreportrs) {
            //contentFis += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click</a><br>";
            if (data.labreportrs) {
                contentFis += "<span class='bold'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportrs == null) {
                contentFis += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return contentFis;
    };

    createClickContentCos = function(value) {
        var contentCos = "";
        var data = value.graphic.attributes;

        if (data.project) {
            contentCos += "<span class='bold' title=''></span><b>" + data.project + "</b><br>";
        }
        if (data.sampleid) {
            contentCos += "<span class='bold' title=''>&ensp; <b>Sample</b></span><br>";
            if (data.sampleid) {
                contentCos += "<span id='chronID' class='bold' data-lyr='7' data-id='" + data.__esri_wfs_id__ + "'>&ensp;&ensp; <b>Identification: </b></span>" + data.sampleid + "<br>";
            }
        }
        if (data.samplematerial) {
            if (data.samplematerial) {
                contentCos += "<span class='bold' title='Sample Material'>&ensp;&ensp; <b>Material: </b></span>" + data.samplematerial + "<br>";
            }
        }
        if (data.exposureage) {
            if (data.exposureage) {
                contentCos += "<span class='bold' title='Conventional Age'>&ensp;&ensp; <b>Age: </b></span>" + data.exposureage.toFixed(2) + " yr <br>";
            }
        }
        if (data.labreportrs) {
            //contentCos += "<span class='bold'><b>Preview All Available Data: </b></span><a id='dataDetail'>Click</a><br>";
            if (data.labreportrs) {
                contentCos += "<span class='bold'><b>Detailed Report: </b></span>" + "<a href='" + "https://geodata.geology.utah.gov/pages/view.php?ref=" + data.labreportrs + "' target='_blank'>Opens in new tab</a>";
            } else if (data.labreportrs == null) {
                contentCos += "<span class='bold'><b>Detailed Report: </b></span>Detailed report not currently available.";
            }
        }

        return contentCos;
    };

    createClickContentProject = function(value) {
        var contentPro = "";
        var data = value.graphic.attributes;

        if (data.project_id) {
            contentPro += "<span class='bold' title='Project Type'><strong>Project</strong></span><br>";

            if (data.project_id) {
                contentPro += "<span id='chronID' class='bold' data-lyr='0' data-id='" + data.__esri_wfs_id__ + "'>&ensp; <strong>Identification Code: </strong></span>" + data.project_id + "<br>";
            }
        }

        if (data.publication_url) {
            if (data.publication_url) {
                contentPro += "<span class='bold' title='Type'>&ensp; <strong>Type: </strong></span><a class='dataDetail' target='_blank' href='" + data.publication_url + "'>" + data.projecttype + "</a><br>";
            } else {
                contentPro += "<span class='bold' title='Type'>&ensp; <strong>Type: </strong></span>" + data.projecttype + "<br>";
            }
        }
        if (data.projectlocation) {
            if (data.projectlocation) {
                contentPro += "<span class='bold' title='Project Location'>&ensp; <strong>Location: </strong></span>" + data.projectlocation + "<br>";
            }
        }
        if (data.orgurl) {
            contentPro += "<span class='bold'><strong>View Project and Organization Details: </strong></span><a id='dataDetail'>Click</a>";
            if (data.orgurl) {
                contentPro += "<br><span class='bold' title='Organization'><strong>Organization: </strong></span><br>&ensp; <a class='dataDetail' target='_blank' href='" + data.orgurl + "'>" + data.orgname + "</a><br>";
            } else {
                contentPro += "<br><span class='bold' title='Organization'><strong>Organization: </strong></span><br>&ensp; " + data.orgname + "<br>";
            }
        }

        return contentPro;
    };

    const topoLabelClass = ({
        labelExpressionInfo: {
            expression: "$feature.quad_name"
        },
        maxScale: 1000,
        minScale: 350000,
        symbol: {
            type: "text", // autocasts as new TextSymbol()
            color: "red",
        }
    });

    //remove panels when user clicks on map
    app.activeView.on("click", function(event) {
        app.activeView.graphics.removeAll();
        $("#panelDetails").removeClass("in");
    });


    // add features //

    var topoIndex = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/General_Info/Topo_Indices/MapServer/2",
        title: "USGS 7.5' Topo Map Index",
        name: "topoindex",
        outFields: ["quad_name"],
        legendEnabled: false,
        listMode: "hide",
        opacity: 0.6,
        visible: false,
        labelingInfo: [topoLabelClass],
        renderer: {
            type: "simple", // autocasts as new SimpleRenderer()
            symbol: {
                type: "simple-fill", // autocasts as new SimpleFillSymbol()
                color: "rgba(255, 0, 0, 0.0)",
                size: 3,
                outline: {
                    color: [255, 0, 0, 0.8],
                    width: 0.5
                }
            }
        }
    });
    app.activeView.map.add(topoIndex);

    topoIndex.labelingInfo = [topoLabelClass];

    // const faults4 = new FeatureLayer({
    //     url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Faults_Quaternary/MapServer/4",
    //     title: "Utah Quaternary Fault & Fold Database",
    //     opacity: 0.9,
    //     legendEnabled: false,
    //     listMode: "hide",
    // });

    // app.activeView.map.add(faults4);

    /*
    var flf = new MapImageLayer({
    url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Faults_Quaternary/MapServer",
    title: "Utah Quaternary Fault & Fold Database",
    legendEnabled: false,
    outFields: ["FaultName"],
    opacity: 0.9,
    listMode: "hide",
    sublayers: [
     {
        id: 3,  // zoomed out symbology
        title: "Faults and Folds (zoomed out)",
        maxScale: 100000,
        minScale: 6000000,
      },
      {
        id: 4,   // zoomed in symbology
        title: "Faults and Folds (zoomed in)",
        maxScale : 1128.49,
        minScale : 99000,
      },
 ]
 });
app.activeView.map.add(flf);  // adds the layer to the map
*/

    //add featurelayers

    /*
    const tritium = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/9",
        outFields: ["*"],
        popupTemplate: {
            title: "Tritium Dating Result Summary",
            content: "{Project:contentTrit}{SampleID:contentTrit}{OBJECTID:contentTrit}{DatingType:contentTrit}{ConventionalAge:contentTrit}{QualitativeAge:contentTrit}{AgeAverageModern:contentTrit}{AgeAverageError:contentTrit}{LabReportRS:contentTrit}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Tritium Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }

    });
    */
    const tritium = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "tritium",
		outFields: ["*"],
        popupTemplate: {
            actions: [popupAction],
            title: "Tritium Dating Result Summary",
            content: getContentTrit
            //content: "{Project:contentTrit}{SampleID:contentTrit}{OBJECTID:contentTrit}{DatingType:contentTrit}{ConventionalAge:contentTrit}{QualitativeAge:contentTrit}{AgeAverageModern:contentTrit}{AgeAverageError:contentTrit}{LabReportRS:contentTrit}"
            
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Tritium Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "brown", //[255, 255, 255],
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});
	//app.activeView.map.add(tritium);
    
   //tritium brown, tephrochron green, cosmogenic lightgreen, fission blue, uranium grey, rubidium yellow, argon purple.
   //radiocarbon & project areas, tan with grey outline

    /*
    const tephro = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/8",
        outFields: ["*"],
        popupTemplate: {
            title: "Tephrochronology Sample and Dating Details",
            content: "{Project:contentTeph}{SampleID:contentTeph}{OBJECTID:contentTeph}{SampleMaterial:contentTeph}{DatingType:contentTeph}{Age:contentTeph}{AgeError:contentTeph}{LabReportsRS:contentTeph}"
        },
        popupEnabled: true,
        displayField: "Project", 
        name: "Tephrochronology Search",
        title: "Tephrochronology Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }

    });
    */
    const tephro = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "tephrochronology",
		outFields: ["*"],
        popupTemplate: {
            actions: [popupAction],
            title:  "Tephrochronology Sample and Dating Details",
            content: contentTeph
            //content: "{Project:contentTeph}{SampleID:contentTeph}{OBJECTID:contentTeph}{SampleMaterial:contentTeph}{DatingType:contentTeph}{Age:contentTeph}{AgeError:contentTeph}{LabReportsRS:contentTeph}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Tephrochronology Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "green", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});
	//app.activeView.map.add(tephro);

   /*
    const carbon = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/2",
        outFields: ["*"],
        popupTemplate: {
            title: "Radiocarbon (<sup>14</sup>C) Sample and Dating Details",
            content: "{Project:createClickContentCarbon}{SampleID:createClickContentCarbon}{OBJECTID:createClickContentCarbon}{SampleMaterial:createClickContentCarbon}{DatingType:createClickContentCarbon}{ConventionalAge:createClickContentCarbon}{CalibratedAge1A:createClickContentCarbon}{CalibratedAge1B:createClickContentCarbon}{CalibratedAge1Sigma:createClickContentCarbon}{CalibratedAge1Unit:createClickContentCarbon}{LabReportsRS:createClickContentCarbon}"
        },
        popupEnabled: true,
        displayField: "Project", 
        name: "Carbon Search",
        title: "Radiocarbon Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        },
        renderer: {
			type: "simple",
			symbol: {
				type: "simple-fill",
				color: [255, 176, 0, 0.5],
				outline: {
					color: [115, 76, 0, 0.5],
					width: 1
				}
			}
		}

    });
    */
    const carbon = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "radiocarbon",
        id: "radiocarbon",
		outFields: ["*"],
        popupTemplate: {
            actions: [popupAction],
            title:  "Radiocarbon (<sup>14</sup>C) Sample and Dating Details",
            content: createClickContentCarbon
            //content: "{Project:createClickContentCarbon}{SampleID:createClickContentCarbon}{OBJECTID:createClickContentCarbon}{SampleMaterial:createClickContentCarbon}{DatingType:createClickContentCarbon}{ConventionalAge:createClickContentCarbon}{CalibratedAge1A:createClickContentCarbon}{CalibratedAge1B:createClickContentCarbon}{CalibratedAge1Sigma:createClickContentCarbon}{CalibratedAge1Unit:createClickContentCarbon}{LabReportsRS:createClickContentCarbon}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Radiocarbon Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: [255, 176, 0, 0.5], 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});
	//app.activeView.map.add(carbon);
   
    /*
    const argon = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/3",
        outFields: ["*"],
        popupTemplate: {
            title: "Argon (<sup>39</sup>Ar/<sup>40</sup>Ar) Dating Result Summary",
            content: "{Project:createClickContentAr}{SampleID:createClickContentAr}{OBJECTID:createClickContentAr}{SampleMaterial:createClickContentAr}{Age:createClickContentAr}{AgeRange:createClickContentAr}{LabReportRS:createClickContentAr}"
        },
        popupEnabled: true,
        displayField: "Project", 
        searchFields: ["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"], 
        name: "Argon Search",
        maxResults: "100",
        maxSuggestions: 16,
        minSuggestCharacters: 2,

        popupOpenOnSelect: true,
        title: "Argon Samples",
        resultSymbol: {
            type: "simple-marker",
            style: "circle",
            color: "cyan",
            size: "9px",
            outline: {   
                color: [0, 255, 255],
                width: 1 // points
            }
        },
        elevationInfo: {
            mode: "relative-to-ground",
        }
    });
    */
    const argon = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "argon",
		outFields: ["*"],  //["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"]
        popupTemplate: {
            actions: [popupAction],
            title:  "Argon (<sup>39</sup>Ar/<sup>40</sup>Ar) Dating Result Summary",
            content: createClickContentAr
            //content: "{project:createClickContentAr}{sampleid:createClickContentAr}{sampleid:createClickContentAr}{samplematerial:createClickContentAr}{age:createClickContentAr}{agerange:createClickContentAr}{labreportrs:createClickContentAr}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Argon Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "purple", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});

    /*
    const luminescence = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/1",
        outFields: ["*"],
        popupTemplate: {
            title: "Luminescence Dating Result Summary",
            content: "{Project:createClickContentLum}{SampleID:createClickContentLum}{OBJECTID:createClickContentLum}{DatingType:createClickContentLum}{Age:createClickContentLum}{AgeRange:createClickContentLum}{LabReportRS:createClickContentLum}"
        },
        popupEnabled: true,
        displayField: "Project", 
        searchFields: ["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"], 
        name: "Luminescence Search",
        maxResults: "100",
        maxSuggestions: 16,
        minSuggestCharacters: 2,
        popupOpenOnSelect: true,
        title: "Luminescence Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }

    });
    */
    const luminescence = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "luminescence",
		outFields: ["*"],  //["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"]
        popupTemplate: {
            actions: [popupAction],
            title: "Luminescence Dating Result Summary",
            content: createClickContentLum
            //content: "{Project:createClickContentLum}{SampleID:createClickContentLum}{OBJECTID:createClickContentLum}{DatingType:createClickContentLum}{Age:createClickContentLum}{AgeRange:createClickContentLum}{LabReportRS:createClickContentLum}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Luminescence Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "cyan", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});

    /*
    const uranium = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/4",
        outFields: ["*"],
        popupTemplate: {
            title: "Uranium-Thorium-Lead Dating Result Summary",
            content: "{Project:createClickContentThor}{SampleID:createClickContentThor}{OBJECTID:createClickContentThor}{SampleMaterial:createClickContentThor}{Age:createClickContentThor}{AgeRange:createClickContentThor}{LabReportRS:createClickContentThor}"
        },
        popupEnabled: true,
        displayField: "Project", 
        searchFields: ["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"], 
        name: "Uranium-Thorium-Lead Search",
        maxResults: "100",
        maxSuggestions: 16,
        minSuggestCharacters: 2,
        popupOpenOnSelect: true,
        title: "Uranium-Thorium-Lead Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }

    });
    */
    const uranium = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "uranium_thorium_lead",
		outFields: ["*"],  
        popupTemplate: {
            actions: [popupAction],
            title: "Uranium-Thorium-Lead Dating Result Summary",
            content: createClickContentThor
            //content: "{Project:createClickContentThor}{SampleID:createClickContentThor}{OBJECTID:createClickContentThor}{SampleMaterial:createClickContentThor}{Age:createClickContentThor}{AgeRange:createClickContentThor}{LabReportRS:createClickContentThor}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Uranium-Thorium-Lead Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "grey", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});
    /*
    const rubidium = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/5",
        outFields: ["*"],
        popupTemplate: {
            title: "Rubidium-Strontium Dating Result Summary",
            content: "{Project:createClickContentRhu}{SampleID:createClickContentRhu}{OBJECTID:createClickContentRhu}{SampleMaterial:createClickContentRhu}{Age:createClickContentRhu}{AgeRange:createClickContentRhu}{LabReportRS:createClickContentRhu}"
        },
        popupEnabled: true,
        displayField: "Project", 
        searchFields: ["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"], 
        name: "Rubidium-Strontium Search",
        maxResults: "100",
        maxSuggestions: 16,
        minSuggestCharacters: 2,
        popupOpenOnSelect: true,
        title: "Rubidium-Strontium Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }

    });
    */
    const rubidium = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "rubidium_strontium",
		outFields: ["*"],  
        popupTemplate: {
            actions: [popupAction],
            title: "Rubidium-Strontium Dating Result Summary",
            content: createClickContentRhu
            //content: "{Project:createClickContentRhu}{SampleID:createClickContentRhu}{OBJECTID:createClickContentRhu}{SampleMaterial:createClickContentRhu}{Age:createClickContentRhu}{AgeRange:createClickContentRhu}{LabReportRS:createClickContentRhu}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Rubidium-Strontium Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "yellow", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});
    /*
    const fission = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/6",
        outFields: ["*"],
        popupTemplate: {
            title: "Fission Track Dating Result Summary",
            content: "{Project:createClickContentFis}{SampleID:createClickContentFis}{OBJECTID:createClickContentFis}{SampleMaterial:createClickContentFis}{Age:createClickContentFis}{LabReportRS:createClickContentFis}"
        },
        popupEnabled: true,
        displayField: "Project", 
        searchFields: ["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"], 
        name: "Fission-Track Search",
        maxResults: "100",
        maxSuggestions: 16,
        minSuggestCharacters: 2,
        popupOpenOnSelect: true,
        title: "Fission Track Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }

    });
    */
    const fission = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "fission_track",
		outFields: ["*"],  
        popupTemplate: {
            actions: [popupAction],
            title: "Fission Track Dating Result Summary",
            content: createClickContentFis
            //content: "{Project:createClickContentFis}{SampleID:createClickContentFis}{OBJECTID:createClickContentFis}{SampleMaterial:createClickContentFis}{Age:createClickContentFis}{LabReportRS:createClickContentFis}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Fission Track Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "blue", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});

    /*
    const cosmo = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/7",
        outFields: ["*"],
        popupTemplate: {
            title: "Cosmogenic Dating Result Summary",
            content: "{Project:createClickContentCos}{SampleID:createClickContentCos}{OBJECTID:createClickContentCos}{SampleMaterial:createClickContentCos}{ExposureAge:createClickContentCos}{LabReportRS:createClickContentCos}"
        },
        popupEnabled: true,
        displayField: "Project", 
        searchFields: ["Project", "SampleBy", "SampleID", "LabSampleID", "SampleMaterial"], 
        name: "Cosmogenic Search",
        maxResults: "100",
        maxSuggestions: 16,
        minSuggestCharacters: 2,
        popupOpenOnSelect: true,
        title: "Cosmogenic Samples",
        elevationInfo: {
            mode: "relative-to-ground",
        }
    });
    */
    const cosmo = new WFSLayer({
        url: "https://ugs-geoserver-prod-flbcoqv7oa-uc.a.run.app/geoserver/wfs",
		name: "cosmogenic",
		outFields: ["*"],  
        popupTemplate: {
            title: "Cosmogenic Dating Result Summary",
            content: createClickContentCos
            //content: "{Project:createClickContentCos}{SampleID:createClickContentCos}{OBJECTID:createClickContentCos}{SampleMaterial:createClickContentCos}{ExposureAge:createClickContentCos}{LabReportRS:createClickContentCos}"
        },
        popupEnabled: true,
        displayField: "Project", 
        title: "Cosmogenic Samples",
        renderer: {
            type: "simple",
                symbol: new SimpleMarkerSymbol({
                color: "lightgreen", 
                outline: {
                    color: [0, 0, 0],
                    width: 1.0
                },
                size: "9px"
            }),
        }
	});

    const projects = new FeatureLayer({
        url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/0",
        outFields: ["*"],
        visible: true,
        title: "Project Areas",
        opacity: .6,
        popupTemplate: {
            title: "{ProjectName}",
            content: "{Project_ID:createClickContentProject}{OBJECTID:createClickContentProject}{Publication_URL:createClickContentProject}{ProjectType:createClickContentProject}{ProjectLocation:createClickContentProject}{OrgURL:createClickContentProject}{OrgName:createClickContentProject}"
        },
        popupEnabled: true,
    });

    app.activeView.map.add(projects);
    app.activeView.map.add(tritium);
    app.activeView.map.add(tephro);
    app.activeView.map.add(cosmo);
    app.activeView.map.add(fission);
    app.activeView.map.add(uranium);
    app.activeView.map.add(rubidium);
    app.activeView.map.add(argon);
    app.activeView.map.add(carbon);
    app.activeView.map.add(luminescence);


    // Search Sources //    ---------------------------------------------------------------------------------------------------------

    const rsymbol = {
                type: "simple-marker",
                style: "circle",
                color: "cyan",
                size: "9px",
                outline: {   
                    color: [0, 255, 255],
                    width: 1 // points
                }
            }

    // see line 976 here,   view-source:https://borehole.geology.utah.gov/
    // see above for: app.searchWidgetNav = new Search({
    var sources = [{
            layer: carbon,
            popupEnabled: true,
            displayField: "project", 
            searchFields:   ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Carbon Search",
            resultSymbol: rsymbol,
        },
        {
            layer: argon,
            popupEnabled: true,
            displayField: "project", 
            searchFields: ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Argon Search",
            resultSymbol: rsymbol,
        },
        {
            layer: luminescence,
            popupEnabled: true,
            displayField: "project", 
            searchFields: ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Luminescence Search",
            resultSymbol: rsymbol,
        },
        {
            layer: uranium,
            popupEnabled: true,
            displayField: "project", 
            searchFields: ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Uranium-Thorium-Lead Search",
            resultSymbol: rsymbol,
        },
        {
            layer: rubidium,
            popupEnabled: true,
            displayField: "project", 
            searchFields: ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Rubidium-Strontium Search",
            resultSymbol: rsymbol,
        },
        {
            layer: fission,
            popupEnabled: true,
            displayField: "project", 
            searchFields: ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Fission-Track Search",
            resultSymbol: rsymbol,
        },
        {
            layer: cosmo,
            popupEnabled: true,
            displayField: "project", 
            searchFields: ["project", "sampledby", "sampleid", "labsampleid", "samplematerial"], 
            name: "Cosmogenic Search",
            resultSymbol: rsymbol,
        },
    ];

    //Search Code
    app.searchWidgetNav.allPlaceholder = "Find Project or Sample";
    app.searchWidgetNav.sources = sources;


    //grid declaration
    /*
    var grid = new(declare([OnDemandGrid, Selection]))({
        class: "grid",
        selectionMode: 'single',
        autoHeight: true,
        autoWidth: true,
        initialWidth: "100%",

        columns: [{
                label: "Project",
                field: "project"
            },
            {
                label: "Sample ID",
                field: "sampleid"
            },
            {
                label: "Dating Method",
                field: "dating_method"
            },
            {
                label: "Dating Type",
                field: "datingtype"
            }
        ]
    }, "grid");
    grid.startup();
    */

    app.searchWidgetNav.on("search-complete", function(e) {
        
        console.log(e.searchTerm);
        app.activeView.popup.clear(); // close popup if its open from last search
        var results = null;  // clear old searches
        //console.log(e["results"]);
        //console.log(e["results"][0].source.layer.id);
        //console.log(e["results"][0].source.layer);
        var featureLayer = e["results"][0].source.layer;
        if (e.searchTerm !== "" && e["results"]) {
           
        showHideCalcitePanels("#panelGrid", "#collapseGrid");
        if (featureTable) featureTable.destroy();
        document.getElementById("grid").innerHTML = "";
        var featureTable = new FeatureTable({
            view: app.activeView,
            layer: featureLayer,
            relatedRecordsEnabled: true,
            container: document.getElementById("grid"),
            effectiveSize: 120,
            tableTemplate: { 
                columnTemplates: [ // takes an array of FieldColumnTemplate and GroupColumnTemplate
                    { 
                        type: "field",
                        fieldName: "project",
                        label: "Project",
                        width: "100px",
                        callback: (params) => {
                            console.log('work!'); //broken
                            app.activeView.goTo(params.feature);
                        }
                    },
                    { 
                        type: "field",
                        fieldName: "sampleid",
                        label: "Sample ID",
                        width: "70px",
                    },
                    { 
                        type: "field",
                        fieldName: "datingmethod",
                        label: "Dating Method",
                        width: "70px",
                    },
                    { 
                        type: "field",
                        fieldName: "datingtype",
                        label: "Dating Type",
                        width: "70px",
                    },
                ]
            }
        });
           
        } // end if
        document.getElementById("grid").style.height = "460px";
        const checkboxEle = document.getElementById("checkboxId");
        checkboxEle.onchange = () => {
            toggleFeatureTable();
        };
        //$("#panelGrid").collapse("show");
        //$("#collapseGrid").collapse("show");

    });


    app.searchWidgetNav.on("search-start", function(e) {
        console.log('starting search');
        app.activeView.popup.close(); //close previous popup when starting new search
        //$("#panelInfo").removeClass("in"); //close any open panels
        //$("#collapseInfo").removeClass("in");
    });

    app.searchWidgetNav.on("search-clear", function(e) {
        document.getElementById("grid").innerHTML = "";
        app.activeView.popup.close();
        $("#panelDetails").removeClass("in"); //close any open panels
        $("#collapseDetails").removeClass("in");
        showHideCalcitePanels("#panelGrid", "#collapseGrid");
    });


    /*

    // use a querytask to get all available details from server
    function populateDetailsPanel_4(layer, id) {
        //console.log("starting query task. id:"+id+", "+layer);
        console.log(id);
        console.log(layer);
        var queryFtr = new Query(); //build query
        queryFtr.where = "OBJECTID = " + id; // "SampleID = 'C9'";   //queryFtr.where = 'SampleID = rowData.SampleID';
        queryFtr.returnGeometry = false;
        queryFtr.outFields = ["*"];
        query.outSpatialReference = {
            wkid: 102100
        };
        //console.log(queryFtr);

        var queryFtrTask = new QueryTask({
            url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Hazards/Geochronology/MapServer/" + layer // URL of a feature layer
        });
        queryFtrTask.execute(queryFtr).then(function(rslt) { //execute query
            // loop through the results and print them to the panel
            var results = rslt.features[0].attributes;
            // first we need to store the field names and aliases in an array to use below.
            console.log(rslt);
            var obProperty = rslt.features[0];
            var labName = obProperty.attributes.Lab;
            console.log(labName);
            var aliases = [];
            $.each(rslt.fields, function(n, i) { //jquery works, dojo doesn't
                //console.log(i.name +", "+i.alias);
                aliases[i.name] = i.alias; // we'll use this in a few lines to substitute names for aliases
            });
            document.getElementById("attDetails").innerHTML = "";

            populateDetails(results);

        });

        // change details panel title
        if (layer == 0) {
            document.getElementById("details").innerHTML = "Project Data";
        } else {
            document.getElementById("details").innerHTML = "All Available Sample Data";
        }

    } // end populateDetailsPanel

        function populateDetailsPanel_new(rslt,layer) {
            document.getElementById("attDetails").innerHTML = "";
            console.log(rslt);
            //var obProperty = rslt[0];
            var labName = rslt.lab;
            console.log(labName);

            populateDetails(rslt);

        // change details panel title
        //if (layer == 0) {
        //    document.getElementById("details").innerHTML = "Project Data";
        //} else {
        //    document.getElementById("details").innerHTML = "All Available Sample Data";
        //}

    } // end function

    */

    // query the server on each click so we can limit data in initialization
    function populateDetailsPanel(atts, lyrid) {
        //id = id.split('.')[1];
        showHideCalcitePanels("#panelDetails", "#collapseDetails");
        //console.log("fetching data from server");
        //console.log(lyrid);
        //console.log(atts);
        var sid = atts.__esri_wfs_id__.split('.').pop();
        //var sid = atts.objectid;

        // #1 get the rest of the data from the main table ----------------------------
        fetch('https://postgrest-seamlessgeolmap-734948684426.us-central1.run.app/'+lyrid+'?objectid=eq.'+sid, {  
            headers: {'Accept-Profile': 'geochron'}
        })
            .then(response => response.json())
            .then(results => {
                //console.log(results);
                if (results.length === 0) console.log("error: for some reason the query returned no results");
                populateDetails(results,lyrid);
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
            
    }; // end function


    function populateDetails(rslt,lyrid) {
        rslt = rslt[0];
        document.getElementById("attDetails").innerHTML = "";
        $.each(rslt, function(key, value) { //jquery works, dojo doesn't
        //console.log(key+", "+value);
        
            if (value) {
                //console.log(value);
                if (!aliases[key]) aliases[key] = key;  // if we haven't defined a alias, just use the key
                if (key === "shape_length" || key === "shape_area" || key === "shape" || key === "__esri_wfs_id__" || key === "objectid") {
                    return;Zoom

                } else if (key === "url_link") { // wrap the link field in an html link so it's clickable
                    document.getElementById("attDetails").innerHTML += aliases[key] + ": <a target='_blank' href='" + value + "'>" + value + "</a><br>";

                } else if (key === "publication_url") { // wrap the link field in an html link so it's clickable
                    document.getElementById("attDetails").innerHTML += "<b>" + aliases[key] + "</b>: <a target='_blank' href='" + value + "'>" + value + "</a><br>";

                } else if (key === "lab") { // format date
                    document.getElementById("attDetails").innerHTML += "<b>" + aliases[key] + "</b>:" + value + "<br>&nbsp;";
                    getLabDetails(value, lyrid);  // since below wont work, just add to bottom.
                    /*
                    const button = document.createElement('button');
                    button.textContent = 'Get lab details';
                    button.addEventListener("click", function() {
                        console.log('YOU CLICKED ME');
                        getLabDetails(value, lyrid);
                    });
                    document.getElementById("attDetails").appendChild(button); 
                    let newLine = document.createElement("br");
                    document.getElementById("attDetails").appendChild(newLine);
                    */

                } else if (key === "recorddate" || key === "labtestdate" || key === "updatedate" || key === "sampledate") { // format date
                    date = moment(value).format('l');
                    document.getElementById("attDetails").innerHTML += "<b>" + aliases[key] + "</b>: " + date + "<br>";

                } else {
                    document.getElementById("attDetails").innerHTML += "<b>" + aliases[key] + "</b>: " + value + "<br>";
                }
                //document.getElementById("attDetails").innerHTML += 'Download .csv of this data: <a id="dataDownload" href='javascript:void(0);'>Here</a><br>';
            } // end if (value)
            
        }); //end .each
    }

    //  MISSING VALUES TO FIX IN ARRAY!    labreportsrs, conventional1sigma, sampledby, [age_206pb_238u and lots of age_xxxxx like it for U/Th dates]


    // do a query task to get all the lab details and add them to details pane
    function getLabDetails(lab, layer) {
        //console.log("GETTING LAB DETAILS!!!!!!!!"); console.log(lab);

        // #1 get the rest of the data from the main table ----------------------------
        fetch('https://postgrest-seamlessgeolmap-734948684426.us-central1.run.app/hazards_laboratory?labcode=eq.'+encodeURI(lab), {
            headers: {'Accept-Profile': 'geochron'}
        })
            .then(response => response.json())
            .then(rslt => {
                //console.log(rslt);
                if (rslt[0]){
                    //console.log('HERE IS THE RESULT!!!!');
                    document.getElementById("labDetails").innerHTML =  "<hr><b>Lab Details</b><br>";
                    //var results = rslt.features[0].attributes;
                    $.each(rslt[0], function(key, value) { //jquery works, dojo doesn't
                        if (value) {
                            //console.log(key+", "+value)
                            if (key == "recorddate" || key == "updatedate") {
                                date = moment(value).format('l');
                                document.getElementById("labDetails").innerHTML += "<b>" + key + "</b>: " + date + "<br>";
                            } else if (key == "laburl") {
                                document.getElementById("labDetails").innerHTML += "<b>" + key + "</b>: <a target='_blank' href='" + value + "'>" + value + "</a><br>";
                            } else if (key == "objectid" || key == "labcode" || key == "labstate") {
                                return;
                            } else if (key == "labactive"){
                                var res = (value === '1') ? 'Yes' :'No';
                                document.getElementById("labDetails").innerHTML += "<b>" + key + "</b>: " + res + "<br>";
                            } else {
                                document.getElementById("labDetails").innerHTML += "<b>" + key + "</b>: " + value + "<br>";
                            }

                        }
                    }); // end .each
                    let text = "Click for Lab Details";
                    let result = text.link("https://www.w3schools.com");
                }
        })
        //.catch(error => {
        //    console.error('Error fetching data:', error);
        //});

        //document.getElementById("details").innerHTML = "Lab Details";

    };


}); // end dojo load

</script>

   <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (for Bootstrap's JavaScript plugins). NOTE: You can also use pure Dojo. See examples. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all  plugins or individual files as needed
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>  -->

</body>
</html>